<template name="insertCharacter">
  <div id="character-form" class="container">
  	<!-- {{> quickForm collection="Characters" id="insertCharacter" type="insert"}} -->

  	{{# autoForm collection="Characters" id="insertCharacter" schema=Schemas.Characters type="insert"}}
  	<div class="section row">
  		<div class="section-title col-md-12">
  			<h1>Section 1: Basics</h1>
  		</div>
  		<div class="col-sm-12 col-md-6">
  			<div class="row">
  				<div class="col-sm-9 col-md-9">
  					<!-- todo: pass col options? -->
  					{{> afFieldInput name='name' type='text' template='charText'}}
  				</div>
  				<div class="col-sm-3 col-md-3">
  					{{> afFieldInput name='level' type='text' template='charText'}}
  				</div>
  			</div>
  			<div class="row">
  				<div class="col-sm-6 col-md-6">
  					{{> afFieldInput name='race' options='allowed' firstOption='' type='select' template='charSelect'}}
  				</div>
  				<div class="col-sm-6 col-md-6">
  					{{> afFieldInput name='class' options='allowed' firstOption='' type='select' template='charSelect'}}
  				</div>
  			</div>
  			<div class="row">
  				<div class="col-sm-6 col-md-6">
  					{{> afFieldInput name='background' options='allowed' firstOption='' type='select' template='charSelect'}}
  				</div>
  				<div class="col-sm-6 col-md-6">
  					{{> afFieldInput name='alignment' options='allowed' firstOption='' type='select' template='charSelect'}}
  				</div>
  			</div>
  			<div class="row image-upload hidden-sm">
  				<div class="col-sm-4 col-md-4">
  					<div style="height: 165px; width: 165px; border: 1px solid #ccc;"></div>
  				</div>
  				<div class="col-sm-7 col-md-8">
  					<label class="top">Character Portrait</label>
  					<p>Select an image from your computer to represent your character (optional).</p>
  					<button><i class="icon ion-plus"></i> Upload</button>
  					<span class="system-message">Upload successful. Looks great!</span>
  				</div>
  			</div>
  		</div>

  		<div class="col-sm-12 col-md-6">
				{{#if fieldHasValue 'race'}}
					{{> infoPanel fieldName='race' charLimit=245}}
				{{/if}}

				{{#if fieldHasValue 'class'}}
	  			{{> infoPanel fieldName='class' charLimit=245}}
	  		{{/if}}

	  		<div class="row">
	  			{{#if fieldHasValue 'background'}}
		  			<div class="col-sm-6 col-md-6">
		  				{{> infoPanel fieldName='background' charLimit=70}}
		  			</div>
	  			{{/if}}
	  			{{#if fieldHasValue 'alignment'}}
	  				<div class="col-sm-6 col-md-6">
		  				{{> infoPanel fieldName='alignment' charLimit=70}}
		  			</div>
	  			{{/if}}
	  		</div>
	  	</div>
	  </div>

  	<div class="section row">
  		<div class="section-title col-md-12">
  			<h1>Section X</h1>
  		</div>

			<div class="col-md-6">
				<!-- todo: ability scores -->
				<div class="row">
					{{#each ability in abilities}}
						<div class="col-sm-4 col-md-4">
							{{> afFieldInput name=fieldName label=false type="text" template="charAbility"}}
							<label>{{ability.name}}</label>
						</div>
					{{/each}}
				</div>

				<div class="row">
					<div class="col-md-6">
						{{> afFieldInput name='proficiencyBonus' type='text' template='charText'}}
					</div>
					<div class="col-md-6">
						{{> afFieldInput name='passivePerception' type='text' template='charText'}}
					</div>
				</div>
			</div>

  		<div class="col-md-6">
  			<div class="character-info-panel">
	  			<div class="row">
	  				<div class="col-md-4">
	  					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
	  				</div>
	  				<div class="col-md-4">
	  					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
	  				</div>
	  				<div class="col-md-4">
	  					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
	  				</div>
	  			</div>
	  			<a href="#"><div class="expand"><i class="ion-plus"></i></div></a>
	  		</div>
  		</div>
  	</div>

  	<div class="section row">
  		<div class="section-title col-md-12">
  			<h1>Section X</h1>
  		</div>

  		<div class="col-md-6">
  			<div class="row">
  				<div class="col-md-4">
  					{{> afFieldInput name='ac' type='text' template='charText'}}
  				</div>
  				<div class="col-md-4">
  					{{> afFieldInput name='initiative' type='text' template='charText'}}
  				</div>
  				<div class="col-md-4">
  					{{> afFieldInput name='speed' type='text' template='charText'}}
  				</div>
  			</div>
  			<div class="row">
  				<div class="col-md-6">
  					{{> afFieldInput name='hitPoints' type='text' template='charText'}}
  				</div>
  				<div class="col-md-6">
  					{{> afFieldInput name='hitDice' type='text' template='charText'}}
  				</div>
  			</div>
  			<!-- TODO: weapons -->
  		</div>

  		<div class="col-md-6">
  			<div class="row">
  				{{> afArrayField name="weapons" template="weapons"}}
  			</div>
  		</div>
  	</div>

  	<div class="section row">
  		<div class="section-title col-md-12">
  			<h1>Section X</h1>
  		</div>

  		<div class="col-md-6">
  			<div class="row">
  				<div class="col-md-4">
  					{{> afFieldInput name='ac' type='text' template='charText'}}
  				</div>
  				<div class="col-md-4">
  					{{> afFieldInput name='initiative' type='text' template='charText'}}
  				</div>
  				<div class="col-md-4">
  					{{> afFieldInput name='speed' type='text' template='charText'}}
  				</div>
  			</div>
  			<div class="row">
  				<div class="col-md-6">
  					{{> afFieldInput name='hitPoints' type='text' template='charText'}}
  				</div>
  				<div class="col-md-6">
  					{{> afFieldInput name='hitDice' type='text' template='charText'}}
  				</div>
  			</div>
  			<!-- TODO: weapons -->
  		</div>

  		<div class="col-md-6">
  			<div class="row">
  				{{> afArrayField name="weapons" template="weapons"}}
  			</div>
  		</div>
  	</div>

  	<div class="row">
  		<button type="submit" class="pull-right">Create Character</button>
  	</div>
  	{{/autoForm}}
  </div>
</template>

<template name="updateCharacter">
	<div class="container">
		{{> quickForm collection="Characters" id="updateCharacter" type="update"}}
	</div>
</template>

<template name="afInputText_charText">
	<input type="text" value="{{this.value}}" class="char-input char-text"/>
	<label>{{afFieldLabelText name=this.atts.name}}</label>
</template>

<template name="afInputText_charAbility">
	<input type="text" value="{{this.value}}" class="char-input char-ability"/>
	<input type="text" value="(+0)" class="char-input ability-target" disabled />
</template>

<template name="afSelect_charSelect">
  <select class="char-input char-select" name='{{this.atts.name}}' data-schema-key='{{this.atts.name}}'>
    {{#each this.items}}
    	{{#if this.optgroup}}
		    <optgroup label="{{this.optgroup}}">
		      {{#each this.items}}
		      <option {{afSelectOptionAtts}}>{{this.label}}</option>
		      {{/each}}
		    </optgroup>
	    {{else}}
	    	<option {{afSelectOptionAtts}}>{{this.label}}</option>
	    {{/if}}
    {{/each}}
  </select>
  <label>{{afFieldLabelText name=this.atts.name}}</label>
</template>

<template name="afArrayField_abilityScores">
	{{#afEachArrayItem name=this.atts.name}}
		<div class="col-md-4">
			<input type="text" value="{{this.value}}" class="char-input char-text"/>
			<label>{{scoreName}}</label>
		</div>
	{{/afEachArrayItem}}
</template>

<template name="afArrayField_weapons">
	{{#afEachArrayItem name=this.atts.name minCount=this.atts.minCount maxCount=this.atts.maxCount}}
		<div class="col-md-6">
			{{> afFieldInput name=this.current.name type='text' template='charText'}}
		</div>
		<div class="col-md-3">
			{{> afFieldInput name=this.current.atkBonus type='text' template='charText'}}
		</div>
		<div class="col-md-3">
			{{> afFieldInput name=this.current.damage type='text' template='charText'}}
		</div>
	{{/afEachArrayItem}}
</template>

<template name="infoPanel">
	<div class="character-info-panel">		
		<div class="character-info">
			<div class="info">
				<span class="title">Your {{fieldName}}</span>
				<span class="attr">{{fieldValue}}</span>
			</div>
			<div class="info">
				<span class="title">Key Traits</span>
				<span class="attr">Darkvision, Fey Ancestry</span>
			</div>
			<!-- TODO: create info template -->
			<!-- <div class="info">
				<span class="title">Primary Attribute</span>
				<span class="attr">Charisma</span>
			</div>
			<div class="info">
				<span class="title">Secondary Attribute</span>
				<span class="attr">Dexterity</span>
			</div> -->
		</div>

		<p>{{excerpt paragraph charLimit}}</p>
		<a href="#"><div class="expand square"><i class="ion-plus"></i></div></a>
	</div>
</template>

<!-- TODO: change these to autoforms with custom templates -->